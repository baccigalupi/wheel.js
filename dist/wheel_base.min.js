/*
 * Wheel.js - version 0.3.0
 * http://github.com/baccigalupi/wheel.js
 * Copyright (c) 2012 Kane Baccigalupi
 * Licensed MIT: http://github.com/baccigalupi/wheel.js/LICENSE.txt
 *
 * Included Libraries:
 * ================================================================
 * Modernizr 2.5.3 (Custom Build) | MIT & BSD
 * Build: http://www.modernizr.com/download/#-draganddrop-touch-cssclasses-teststyles-hasevent-prefixes-load
 *
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 *
 * Zepto v1.0rc1 - polyfill zepto event detect fx ajax form touch - zeptojs.com/license
 *
 * jQuery JavaScript Library v1.7.2
 *  http://jquery.com/ Copyright 2011, John Resig. Dual licensed under the MIT or GPL Version 2 licenses. http://jquery.org/license
 *  Includes Sizzle.js http://sizzlejs.com/ Copyright 2011, The Dojo Foundation. Released under the MIT, BSD, and GPL Licenses.
 *
 * Backbone.js 0.9.2 (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.MIT license.
 *
 * todo: add ember, jquery cookies plugin, remy's localStorage fill??
 *
 */
window.Modernizr=function(e,t,n){function x(e){f.cssText=e}function T(e,t){return x(h.join(e+";")+(t||""))}function N(e,t){return typeof e===t}function C(e,t){return!!~(""+e).indexOf(t)}function k(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return r===!1?e[i]:N(s,"function")?s.bind(r||t):s}return!1}var r="2.5.3",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,l,c={}.toString,h=" -webkit- -moz- -o- -ms- ".split(" "),p={},d={},v={},m=[],g=m.slice,y,b=function(e,n,r,i){var s,a,f,l=t.createElement("div"),c=t.body,h=c?c:t.createElement("body");if(parseInt(r,10))while(r--)f=t.createElement("div"),f.id=i?i[r]:u+(r+1),l.appendChild(f);return s=["&#173;","<style>",e,"</style>"].join(""),l.id=u,(c?l:h).innerHTML+=s,h.appendChild(l),c||(h.style.background="",o.appendChild(h)),a=n(l,e),c?l.parentNode.removeChild(l):h.parentNode.removeChild(h),!!a},w=function(){function r(r,i){i=i||t.createElement(e[r]||"div"),r="on"+r;var s=r in i;return s||(i.setAttribute||(i=t.createElement("div")),i.setAttribute&&i.removeAttribute&&(i.setAttribute(r,""),s=N(i[r],"function"),N(i[r],"undefined")||(i[r]=n),i.removeAttribute(r))),i=null,s}var e={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return r}(),E={}.hasOwnProperty,S;!N(E,"undefined")&&!N(E.call,"undefined")?S=function(e,t){return E.call(e,t)}:S=function(e,t){return t in e&&N(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError;var r=g.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(g.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(g.call(arguments)))};return i});var L=function(n,r){var s=n.join(""),o=r.length;b(s,function(n,r){var s=t.styleSheets[t.styleSheets.length-1],u=s?s.cssRules&&s.cssRules[0]?s.cssRules[0].cssText:s.cssText||"":"",a=n.childNodes,f={};while(o--)f[a[o].id]=a[o];i.touch="ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch||(f.touch&&f.touch.offsetTop)===9},o,r)}([,["@media (",h.join("touch-enabled),("),u,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);p.touch=function(){return i.touch},p.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e};for(var A in p)S(p,A)&&(y=A.toLowerCase(),i[y]=p[A](),m.push((i[y]?"":"no-")+y));return x(""),a=l=null,i._version=r,i._prefixes=h,i.hasEvent=w,i.testStyles=b,o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+m.join(" "):""),i}(this,this.document),function(e,t,n){function r(e){return d.call(e)=="[object Function]"}function i(e){return typeof e=="string"}function s(){}function o(e){return!e||e=="loaded"||e=="complete"||e=="uninitialized"}function u(){var e=v.shift();m=1,e?e.t?h(function(){(e.t=="c"?k.injectCss:k.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),u()):m=0}function a(e,n,r,i,s,a,f){function l(t){if(!d&&o(c.readyState)&&(w.r=d=1,!m&&u(),c.onload=c.onreadystatechange=null,t)){e!="img"&&h(function(){b.removeChild(c)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var f=f||k.errorTimeout,c={},d=0,g=0,w={t:r,s:n,e:s,a:a,x:f};T[n]===1&&(g=1,T[n]=[],c=t.createElement(e)),e=="object"?c.data=n:(c.src=n,c.type=e),c.width=c.height="0",c.onerror=c.onload=c.onreadystatechange=function(){l.call(this,g)},v.splice(i,0,w),e!="img"&&(g||T[n]===2?(b.insertBefore(c,y?null:p),h(l,f)):T[n].push(c))}function f(e,t,n,r,s){return m=0,t=t||"j",i(e)?a(t=="c"?E:w,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),v.length==1&&u()),this}function l(){var e=k;return e.loader={load:f,i:0},e}var c=t.documentElement,h=e.setTimeout,p=t.getElementsByTagName("script")[0],d={}.toString,v=[],m=0,g="MozAppearance"in c.style,y=g&&!!t.createRange().compareNode,b=y?c:p.parentNode,c=e.opera&&d.call(e.opera)=="[object Opera]",c=!!t.attachEvent&&!c,w=g?"object":c?"script":"img",E=c?"script":w,S=Array.isArray||function(e){return d.call(e)=="[object Array]"},x=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},C,k;k=function(e){function t(e){var e=e.split("!"),t=x.length,n=e.pop(),r=e.length,n={url:n,origUrl:n,prefixes:e},i,s,o;for(s=0;s<r;s++)o=e[s].split("="),(i=N[o.shift()])&&(n=i(n,o));for(s=0;s<t;s++)n=x[s](n);return n}function o(e,i,s,o,a){var f=t(e),c=f.autoCallback;f.url.split(".").pop().split("?").shift(),f.bypass||(i&&(i=r(i)?i:i[e]||i[o]||i[e.split("/").pop().split("?")[0]]||u),f.instead?f.instead(e,i,s,o,a):(T[f.url]?f.noexec=!0:T[f.url]=1,s.load(f.url,f.forceCSS||!f.forceJS&&"css"==f.url.split(".").pop().split("?").shift()?"c":n,f.noexec,f.attrs,f.timeout),(r(i)||r(c))&&s.load(function(){l(),i&&i(f.origUrl,a,o),c&&c(f.origUrl,a,o),T[f.url]=2})))}function a(e,t){function n(e,n){if(e){if(i(e))n||(f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),o(e,f,t,0,u);else if(Object(e)===e)for(p in h=function(){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}(),e)e.hasOwnProperty(p)&&(!n&&!--h&&(r(f)?f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:f[p]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),c()}}(l[p])),o(e[p],f,t,p,u))}else!n&&c()}var u=!!e.test,a=e.load||e.both,f=e.callback||s,l=f,c=e.complete||s,h,p;n(u?e.yep:e.nope,!!a),a&&n(a)}var f,c,h=this.yepnope.loader;if(i(e))o(e,0,h,0);else if(S(e))for(f=0;f<e.length;f++)c=e[f],i(c)?o(c,0,h,0):S(c)?k(c):Object(c)===c&&a(c,h);else Object(e)===e&&a(e,h)},k.addPrefix=function(e,t){N[e]=t},k.addFilter=function(e){x.push(e)},k.errorTimeout=1e4,t.readyState==null&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",C=function(){t.removeEventListener("DOMContentLoaded",C,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=u,e.yepnope.injectJs=function(e,n,r,i,a,f){var l=t.createElement("script"),c,d,i=i||k.errorTimeout;l.src=e;for(d in r)l.setAttribute(d,r[d]);n=f?u:n||s,l.onreadystatechange=l.onload=function(){!c&&o(l.readyState)&&(c=1,n(),l.onload=l.onreadystatechange=null)},h(function(){c||(c=1,n(1))},i),a?l.onload():p.parentNode.insertBefore(l,p)},e.yepnope.injectCss=function(e,n,r,i,o,a){var i=t.createElement("link"),f,n=a?u:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(f in r)i.setAttribute(f,r[f]);o||(p.parentNode.insertBefore(i,p),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function a(e){return u.test(e)}function p(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return h[e]||e})}function d(e,t,n,r){r=r||"<template>";var i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),u=i.slice(s,o),a;for(var f=0,l=u.length;f<l;++f)a=f+s+1,u[f]=(a===n?" >> ":"    ")+u[f];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,u.join("\n"),"",e.message].join("\n"),e}function v(e,t,n){if(e===".")return t[t.length-1];var r=e.split("."),i=r.length-1,s=r[i],o,u,a=t.length,f,l;while(a){l=t.slice(0),u=t[--a],f=0;while(f<i){u=u[r[f++]];if(u==null)break;l.push(u)}if(u&&typeof u=="object"&&s in u){o=u[s];break}}return typeof o=="function"&&(o=o.call(l[l.length-1])),o==null?n:o}function m(e,t,n,r){var i="",u=v(e,t);if(r){if(u==null||u===!1||s(u)&&u.length===0)i+=n()}else if(s(u))o(u,function(e){t.push(e),i+=n(),t.pop()});else if(typeof u=="object")t.push(u),i+=n(),t.pop();else if(typeof u=="function"){var a=t[t.length-1],f=function(e){return S(e,a)};i+=u.call(a,n(),f)||""}else u&&(i+=n());return i}function g(t,n){n=n||{};var r=n.tags||e.tags,i=r[0],s=r[r.length-1],o=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],u=[],l=!1,c=!1,h=function(){if(l&&!c&&!n.space)while(u.length)o.splice(u.pop(),1);else u=[];l=!1,c=!1},p=[],v,m,g,y=function(e){r=f(e).split(/\s+/),m=r[0],g=r[r.length-1]},b=function(e){o.push('";',v,'\nvar partial = partials["'+f(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,r){var i=f(e);if(i==="")throw d(new Error("Section name may not be empty"),t,N,n.file);p.push({name:i,inverted:r}),o.push('";',v,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var r=f(e),i=p.length!=0&&p[p.length-1].name;if(!i||r!=i)throw d(new Error('Section named "'+r+'" was never opened'),t,N,n.file);var s=p.pop();o.push('";',"\n    return buffer;","\n  };","\n})();"),s.inverted?o.push("\nbuffer += renderSection(name,stack,callback,true);"):o.push("\nbuffer += renderSection(name,stack,callback);"),o.push('\nbuffer += "')},x=function(e){o.push('";',v,'\nbuffer += lookup("'+f(e)+'",stack,"");','\nbuffer += "')},T=function(e){o.push('";',v,'\nbuffer += escapeHTML(lookup("'+f(e)+'",stack,""));','\nbuffer += "')},N=1,C,k;for(var L=0,A=t.length;L<A;++L)if(t.slice(L,L+i.length)===i){L+=i.length,C=t.substr(L,1),v="\nline = "+N+";",m=i,g=s,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,s="="+s,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":s="}"+s;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}var O=t.indexOf(s,L);if(O===-1)throw d(new Error('Tag "'+i+'" was not closed properly'),t,N,n.file);var M=t.substring(L,O);k&&k(M);var _=0;while(~(_=M.indexOf("\n",_)))N++,_++;L=O+s.length-1,i=m,s=g}else{C=t.substr(L,1);switch(C){case'"':case"\\":c=!0,o.push("\\"+C);break;case"\r":break;case"\n":u.push(o.length),o.push("\\n"),h(),N++;break;default:a(C)?u.push(o.length):c=!0,o.push(C)}}if(p.length!=0)throw d(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,N,n.file);h(),o.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=o.join("").replace(/buffer \+= "";\n/g,"");return n.debug&&(typeof console!="undefined"&&console.log?console.log(D):typeof print=="function"&&print(D)),D}function y(e,t){var n="view,partials,stack,lookup,escapeHTML,renderSection,render",r=g(e,t),i=new Function(n,r);return function(n,r){r=r||{};var s=[n];try{return i(n,r,s,v,p,m,S)}catch(o){throw d(o.error,e,o.line,t.file)}}}function w(){b={}}function E(e,t){return t=t||{},t.cache!==!1?(b[e]||(b[e]=y(e,t)),b[e]):y(e,t)}function S(e,t,n){return E(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=g,e.compile=E,e.render=S,e.clearCache=w,e.to_html=function(e,t,n,r){var i=S(e,t,n);if(typeof r!="function")return i;r(i)};var t=Object.prototype.toString,n=Array.isArray,r=Array.prototype.forEach,i=String.prototype.trim,s;n?s=n:s=function(e){return t.call(e)==="[object Array]"};var o;r?o=function(e,t,n){return r.call(e,t,n)}:o=function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var u=/^\s*$/;var f;if(i)f=function(e){return e==null?"":i.call(e)};else{var l,c;a(" ")?(l=/^\s+/,c=/\s+$/):(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),f=function(e){return e==null?"":String(e).replace(l,"").replace(c,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var b={}})(Mustache);var Wheel={Mixins:{},Utils:{},Widgeteria:{}};!window.w&&(window.w=Wheel),Wheel.Utils.ObjectPath={write:function(e,t,n){e=e.split("."),n=n||window;var r=e.length,i;if(r>1)for(i=0;i<r-1;i++)n[e[i]]||(n[e[i]]={}),n=n[e[i]];return n[e[r-1]]=t,t},read:function(e,t){e=e.split("."),t=t||window;var n=e.length,r;for(r=0;r<n;r++){if(!t[e[r]])return null;t=t[e[r]]}return t}},function(e){e._?(Wheel.isFunction=_.isFunction,Wheel.isString=_.isString,Wheel.isNumber=_.isNumber,Wheel.isNull=_.isNull,Wheel.isUndefined=_.isUndefined,Wheel.isElement=_.isElement,Wheel.isArray=_.isArray,Wheel.isObject=_.isObject):(Wheel.isFunction=function(e){return typeof e=="function"||toString.call(e)=="[object Function]"},Wheel.isString=function(e){return toString.call(e)=="[object String]"},Wheel.isNumber=function(e){return toString.call(e)=="[object Number]"},Wheel.isNull=function(e){return e===null},Wheel.isUndefined=function(e){return e===void 0},Wheel.isElement=function(e){return!!e&&e.nodeType==1},Wheel.isArray=function(e){return toString.call(e)=="[object Array]"},Wheel.isObject=function(e){return e===Object(e)&&!Wheel.isFunction(e)&&!Wheel.isArray(e)}),Wheel.is$=function(e){return!!e.addClass}}(window),Wheel.Mixins.Events={on:function(e,t,n){var r,i,s,o,u;if(!t)return this;e=e.split(" "),r=this._callbacks||(this._callbacks={});while(i=e.shift())u=r[i],s=u?u.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:u?u.next:s};return this},off:function(e,t,n){var r,i,s,o,u,a;if(!(i=this._callbacks))return this;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(" "):_.keys(i);while(r=e.shift()){s=i[r],delete i[r];if(!s||!t&&!n)continue;o=s.tail;while((s=s.next)!==o)u=s.callback,a=s.context,(t&&u!==t||n&&a!==n)&&this.on(r,u,a)}return this},trigger:function(e){var t,n,r,i,s,o,u,a;if(!(r=this._callbacks))return this;a=Array.prototype.slice,o=r.all,e=e.split(" "),u=a.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,u)}if(n=o){i=n.tail,s=[t].concat(u);while((n=n.next)!==i)n.callback.apply(n.context||this,s)}}return this}},Wheel.Mixins.Ajax={send:function(e){e=e||{};var t=e.data||this.data(),n={url:e.url||this.url,data:t,type:e.httpMethod||this.httpMethod,dataType:this.dataType||"json",success:e.success||this.onSuccess,error:this.processError,complete:e.complete||this.onCompletion};e&&$.extend(n,e),this._send(n)},_send:function(e){e.success=e.success.bind(this),e.complete=e.complete.bind(this),e.error=e.error.bind(this),$.ajax(e)},processError:function(e){try{this.onError(JSON.parse(e.responseText))}catch(t){this.onError({status:e.statusCode(),message:e.responseText})}},data:function(){return{}},onCompletion:function(e){},onSuccess:function(e){},onError:function(e){}},function(){Function.prototype.bind=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};var e=function(e,t){function n(){}var r=function(){var r,i=this._super;return this._super=t||n,r=e.apply(this,arguments),this._super=i,r};return r.base=e,r},t=function(t,n,r){if(!n)return t;for(prop in n){if(prop.match(/prototype|__proto__|superclass/))continue;var i,s;r?(i=n[prop],s=t[prop]):(i=t[prop],s=n[prop]);if(i&&s&&typeof s=="function")t[prop]=function(t,n){return e(t,n)}(s,i);else if(s||i)t[prop]=s||i}return t};Wheel._Class=function(){},Wheel._Class.mashin=function(e){return t(this,e,!0),this},Wheel._Class.mashover=function(e){return t(this,e),this},Wheel._Class.mixin=function(e){return t(this.prototype,e,!0),this},Wheel._Class.mixover=function(e){return t(this.prototype,e),this};var n=!1;Wheel._Class.subclass=function(){function o(){n||this.initialize&&this.initialize.apply(this,arguments)}var e,r,i,s;typeof arguments[0]=="string"?(e=arguments[0],i=arguments[1],s=arguments[2]):(i=arguments[0],s=arguments[1]),n=!0,r=new this,n=!1;for(u in this){var u;if(u=="prototype")continue;o[u]=this[u]}return t(o,s),o.superclass=this,o._subclass=Wheel._Class.subclass,o.prototype=t(r,i),o.prototype.constructor=o,o.prototype.superclass=this.prototype,o.prototype._class=o.prototype.constructor,e&&(o.id=e,Wheel.Utils.ObjectPath.write(e,o)),o}}(),Wheel._Class.subclass("Wheel.Base",{initialize:function(e){this._preInit(e),this.init(),this._postInit()},_preInit:function(e){this._uid=this._class.uid(),this.optionize(e)},_postInit:function(){this.listen()},optionize:function(e){var t={},n;for(n in e)typeof this._class.prototype[n]=="function"?this["_"+n]=e[n]:this[n]=e[n]},init:function(){},listen:function(){},publish:function(e,t){this._publisher||this._findPublisher(),this._publisher.trigger(e,t)},subscribe:function(e,t,n){this._publisher||this._findPublisher(),this._publisher.on(e,t,n||this)},_findPublisher:function(){this._publisher=this._class.App&&this._class.App.app||Wheel.Publisher;if(!this._publisher)throw"Cannot find app or Wheel.Publisher. Please namespace your classes under an application class or assign a Wheel.Publisher"}},{uid:function(){return Wheel.Base._uid=Wheel.Base._uid||0,++Wheel.Base._uid},build:function(){function t(t){return e.apply(this,t)}var e=this;return t.prototype=e.prototype,new t(arguments)},attrAccessor:function(e){var t="_"+e;this.prototype[e]=function(n){return n!==undefined&&(this[t]=n,self[t]!=n&&(this.trigger("change"),this.trigger("change:"+e))),this[t]}},subclass:function(e,t,n){var r=this._subclass(e,t,n);r.properties&&r.properties.length&&$.each(r.properties,function(e,t){typeof r.prototype[t]!="function"&&r.attrAccessor(t)});if(Wheel.isString(e)){var i=e.split("."),s=i.length,o,u=window;for(o=0;o<s-1;o++){u=window[i[o]];if(u&&u._typeof==="Wheel.App"){r.App=u;break}}}return r}}),Wheel.Base.mixin(Wheel.Mixins.Events),Wheel.Mixins.ManagedAjax?Wheel.Base.mixin(Wheel.Mixins.ManagedAjax):Wheel.Base.mixin(Wheel.Mixins.Ajax),Wheel.Class=function(e,t,n){return Wheel.Base.subclass(e,t,n)},Wheel.Base.subclass("Wheel.Class.Singleton",{initialize:function(e){this._class.singleton||(this._class.singleton=this,this._super(e))}},{build:function(){return this.singleton?this.singleton:this._super.apply(this,arguments)}}),Wheel.Utils.Loader={canZepto:function(e){e=e||navigator.userAgent;var t=!1;return/AppleWebKit/i.test(e)?/Silk\/(\d+)/i.test(e)?t=parseInt(e.match(/Silk\/(\d+)/i)[1])>=1:/mobile|android/i.test(e)?t=parseInt(e.match(/version\/(\d+)/i)[1])>=4:/webos\/(\d+)\.(\d+)\.(\d+)/i.test(e)?t=this._versionTest(e.match(/webos\/(\d+)\.(\d+)\.(\d+)/i),[1,4,5]):/RIM Tablet OS (\d+)\.(\d+)\.(\d+)/i.test(e)?t=this._versionTest(e.match(/RIM Tablet OS (\d+)\.(\d+)\.(\d+)/i),[1,0,7]):t=e.match(/Chrome\/(\d+)/)&&parseInt(e.match(/Chrome\/(\d+)/)[1])>=5||/Version\/5.*Safari/.test(e):t=e.match(/Firefox\/(\d+)/)&&parseInt(e.match(/Firefox\/(\d+)/)[1])>=4||e.match(/(Opera).*Version\/(\d+)/i)&&parseInt(e.match(/Version\/(\d+)/i)[1])>=10,!!t},_versionTest:function(e,t){return e[1]=parseInt(e[1]),e[2]=parseInt(e[2]),e[3]=parseInt(e[3]),e[1]>=t[0]&&(e[2]>t[1]||e[2]==t[1]&&e[3]>=t[2])}},Wheel.Class.Singleton.subclass("Wheel.Utils.ConnectionChecker",{init:function(){this.url="/",this.intervalDelay=this._class.intervalDelay,this.pollCount=0,this._super()},opts:{async:!1,url:this.url,context:this,type:"head",dataType:"json"},test:function(){$.ajax($.extend(this.opts,{success:this.onSuccess,error:this.onError}))},clearInterval:function(){this.interval&&(clearInterval(this.interval),this.interval=undefined)},setInterval:function(){this.interval=setInterval(function(){$.ajax($.extend(this.opts,{success:self.stopPoll,error:self.continuePoll}))},this.intervalDelay)},startPoll:function(){var e=this;this.pollCount=1,this.setInterval()},isPolling:function(){return!!this.interval},stopPoll:function(){this.clearInterval(),this.intervalDelay=this._class.intervalDelay,this.pollCount=0,this.onSuccess()},continuePoll:function(){this.pollCount++,this.pollCount>10&&this.intervalDelay<this._class.intervalDelayLimit&&(this.clearInterval(),this.intervalDelay*=2,this.setInterval(),this.pollCount=0)},onSuccess:function(e){this.trigger("online")},onError:function(e){this.trigger("offline"),!this.isPolling()&&this.startPoll()}},{intervalDelay:1e4,intervalDelayLimit:12e4,id:"Wheel.Utils.ConnectionChecker"}),Wheel.Utils.ConnectionChecker.mixin(Wheel.Mixins.Events),Wheel.Class.Singleton.subclass("Wheel.Utils.RequestQueue",{init:function(){this._requestCount=0,this._requests=[],this._contexts={},this._state="online",this.app.on("offline",this.offline,this)},add:function(e){this._requests.push(e),this.start()},_inContext:function(e){return!!(e&&e._uid&&this._contexts[e._uid])},start:function(e){e=e||0;var t=this._requests[e];if(t&&this._state=="online"&&this.app.connected()&&this._requestCount<this._class.connectionLimit()){var n=t.context&&t.context._uid;!t._inProgress&&!this._inContext(t.context)&&(this.send(t),this._requests[e]._inProgress=!0,n&&(this._contexts[n]=!0),this._requestCount++),this.start(e+1)}},offline:function(){this._state="offline",this.app.on("online",this.restart,this)},restart:function(){this.app.off("online",this.restart),this._state="restarting";var e=this;setTimeout(function(){e._reset()},5e3)},_reset:function(){this._state=="restarting"&&(this.start(),this._requestCount=0,this._contexts={},$.each(this._requests,function(e,t){t._inProgress&&(t._inProgress=!1)}))},send:function(e){var t=this,n=$.extend({},e);n.success=function(n){t.onSuccess(n,e)},n.complete=function(n){t.onComplete(n,e)},n.error=function(n){t.onError(n,e)},typeof n.url=="function"&&(n.url=n.url());var r=(n.httpMethod||n.type||"get").toLowerCase();if(r=="put"||r=="delete")n.type="post",n.data=n.data||{},n.data._method=r;n.context=null,$.ajax(n)},onSuccess:function(e,t){this._clearRequest(t),this._callback(e,t,"success")},onError:function(e,t){this.app.checkConnection(),this.app.connected()&&(this._clearRequest(t),this._callback(e,t,"error"))},onComplete:function(e,t){this._requestCount--,this.app.connected()&&(this._callback(e,t,"complete"),this.start())},_clearRequest:function(e){e.context&&e.context._uid&&delete this._contexts[e.context._uid],this._requests.splice(this._requests.indexOf[e],1)},_callback:function(e,t,n){t[n]&&(t.context?t[n].apply(t.context,[e]):t[n](e))}},{connectionLimit:function(){return this._connectionLimit||(this._connectionLimit=Wheel.Utils.Loader.canZepto()?6:2),this._connectionLimit},id:"Wheel.Utils.RequestQueue"}),Wheel.Class("Wheel.App",{_preInit:function(e){this._super(e),this.initApp(),this._class.app=this,this._class.App=this._class},initApp:function(){this.eventManager=Modernizr.touch?Wheel.TouchManager.build():Wheel.MouseManager.build(),this.templates=Wheel.Templates.build(),this.templates.gather()},manageRequests:function(){this.connectionChecker=Wheel.Utils.ConnectionChecker.build(),this.requestQueue=Wheel.Utils.RequestQueue.build({app:this}),this.connectionChecker.on("offline",function(){this.connected(!1)}.bind(this)),this.connectionChecker.on("online",function(){this.connected(!0)}.bind(this))},checkConnection:function(){"onLine"in navigator&&navigator.onLine==0?this.connected(!1):this.connectionChecker.test()},connected:function(e){if(e!=undefined&&this._connected!=e){var t=e?"online":"offline";this._connected=e,this.trigger(t)}return e===!1&&this.trigger("offline-beacon"),this._connected}},{Views:{},Models:{},_typeof:"Wheel.App",subclass:function(e,t,n){this.children=this.children||[];var r=this._super(e,t,n);return this.children.push(r),r},start:function(){this.children&&$.each(this.children,function(e,t){t.build()})}}),Wheel.Class.Singleton.subclass("Wheel.Templates",{optionize:function(e){this.append(e)},gather:function(){var e=this;$("script.template").each(function(t,n){var r=$(n);Wheel.Utils.ObjectPath.write(r.attr("name"),r.html(),e)})},retrieve:function(e){var t=this;$.ajax({url:e||"/templates",success:function(e){t.append(e)}})},append:function(e){var t;for(t in e)Wheel.Utils.ObjectPath.write(t,e[t],this)}}),Wheel.Class("Wheel.View",{initialize:function(e,t){this.initializeDom(e,t),this.init(),this._postInit()},initializeDom:function(e,t){e&&(e.addClass||e instanceof HTMLElement||Wheel.isString(e))?(this._preInit(t),this.$=this.wrapDom(e)):(this._preInit(e),this.$=this.renderDefault())},wrapDom:function(e){return $(e)},renderDefault:function(){var e=this.renderTemplate();return this.parent&&this.appendToParent(e),e},renderTemplate:function(e,t){var n;return Wheel.isString(e)?n=e:t=e,$(Mustache.render(this._class.template(n),t||this.viewModel()))},appendToParent:function(e){this.parent.append?this.parent.append(e):$(this.parent).append(e)},viewModel:function(){var e;return this.model?e=this.model:e=this,e},_delegate:function(e,t){if($.isArray(t)){var n=this;$.each(t,function(t,r){n._delegateOne(e,r)})}else this._delegateOne(e,t)},_delegateOne:function(e,t){this.$[e](t.$||t)},append:function(e){this._delegate("append",e)},prepend:function(e){this._delegate("prepend",e)},find:function(e){this._delegateOne(e)}},{templateRepository:function(){return this._templateRepository||(this._templateRepository=this._getTemplateRepository()),this._templateRepository},_getTemplateRepository:function(){return this.App&&this.App.app&&this.App.app.templates},templates:function(){if(!this._templates&&this!==Wheel.View){this._templates=Wheel.Utils.ObjectPath.read(this.id,this.templateRepository());var e=this.superclass.templates&&this.superclass.templates();if(e&&this._templates){var t;for(t in e)this._templates[t]||(this._templates[t]=e[t])}}return this._templates},defaultTemplate:"default",template:function(e){var t=this.templates();if(!t)throw"No templates found for View: "+this.id;var n;return Wheel.isString(t)?n=t:n=e?t[e]:t[this.defaultTemplate],n},gather:function(e,t){if(!this.selector)throw"Define a selector on the class to use the 'gather' class method";var n=[],r=this;return Wheel.isObject(e)&&!Wheel.isElement(e)?(t=e,e=$(document.body)):(t=t||{},e=Wheel.is$(e)?e:$(e)),e.is(this.selector)?n.push(new r(e,t)):$.each(e.find(this.selector),function(e,i){n.push(new r(i,t))}),n},assemble:function(e,t){var n=[];return t=t||{},$.each(e,function(e,r){t.model=r,n.push(this.build(t))}.bind(this)),n}}),Wheel.View.subclass("Wheel.EventManager",{initializeDom:function(e){this.optionize(e),this.$=$(document)},listen:function(){var e=this;this.$.on("pullinit",function(t){e.onPullInit(t)})},onPullInit:function(e){e.preventDefault(),this._setTarget(e),this.touch.type="pull",e=this._unpackEvent(e),this._triggerEvent(e,"pullstart")},onStart:function(e){this.touch.ctrl=e.ctrlKey,e=this._normalizeEvent(e),this._setTarget(e),this._triggerEvent(e,"tapstart"),this._clearTimeout(),this.touch.x1=e.pageX,this.touch.y1=e.pageY,this.touch.time=Date.now();if(!this._testDoubleTap()&&!this.touch.ctrl){var t=this;this.touchTimout=setTimeout(function(){t._testTouchhold(e)},this.HOLD_DELAY)}},onMove:function(e){this._handlePullMove(e);if(this.touch.type)return;e=this._unpackEvent(e),this._testSwipe(e)},onEnd:function(e){e=this._unpackEvent(e),this._triggerEvent(e,"tapend"),this._handlePullEnd(e),this.touch.type||this.touch.ctrl?this._resetTouch():this._handleTap(e)},_triggerEvent:function(e,t,n){if(!this.target)return;n=n||{},n.pageX="x2"in this.touch?this.touch.x2:this.touch.x1,n.pageY="y2"in this.touch?this.touch.y2:this.touch.y1,n.originalEvent=e,this.target.trigger($.Event(t||this.touch.type,n))},_setTarget:function(e){var t=e.target;this.target=$("tagName"in t?t:t.parentNode)},_clearTimeout:function(){this.touchTimeout&&clearTimeout(this.touchTimeout)},_resetTouch:function(){this.lastTouch=this.touch,this.lastTouch.target=this.target,this.target=null,this.touch={}},_normalizeEvent:function(e){return e},_unpackEvent:function(e){return e=this._normalizeEvent(e),e.type!=="touchend"&&(this.touch.x2=e.pageX>=0?e.pageX:this.touch.x1,this.touch.y2=e.pageY>=0?e.pageY:this.touch.y1),e},_handleTap:function(e){if(this.RESPONSIVE_TAP)this._onTap(e);else{var t=this;this.touchTimeout=setTimeout(function(){t._onTap(e)},this.DOUBLE_DELAY)}},_handlePullMove:function(e){this.touch.type&&this.touch.type==="pull"&&(e.preventDefault(),e=this._unpackEvent(e),this._triggerEvent(e,"pullmove",this._eventDetails()))},_eventDetails:function(){var e=this.touch.x2-this.touch.x1,t=this.touch.y2-this.touch.y1,n=Date.now()-this.touch.time,r=Math.sqrt(e*e+t*t);return{deltaX:e,deltaY:t,deltaTime:n,distance:r,velocity:r/n,angle:Math.atan2(t,e)}},_handlePullEnd:function(e){this.touch.type&&this.touch.type==="pull"&&(e=this._unpackEvent(e),this._triggerEvent(e,"pullend"))},_onTap:function(e){this.touchTimeout=null,this.target&&e.target===this.target[0]&&this.TAP_TOLERANCE>=Math.abs(this.touch.x1-this.touch.x2)&&this.TAP_TOLERANCE>=Math.abs(this.touch.y1-this.touch.y2)&&(this.touch.type="tap",this._triggerEvent(e)),this._resetTouch()},_testDoubleTap:function(e){var t=this.lastTouch&&this.lastTouch.time?this.touch.time-this.lastTouch.time:0;if(t>0&&t<=this.DOUBLE_DELAY)return this.touch.type="doubletap",this._triggerEvent(e),!0},_testSwipe:function(e){if(Math.abs(this.touch.x1-this.touch.x2)>=this.SWIPE_TOLERANCE||Math.abs(this.touch.y1-this.touch.y2)>=this.SWIPE_TOLERANCE){this.touch.type="swipe";var t=this._direction(this.touch.x1,this.touch.x2,this.touch.y1,this.touch.y2);this.preventScroll(t)&&e.preventDefault(),this._triggerEvent(e,"swipe",this._eventDetails()),this._triggerEvent(e,"swipe"+t)}},_testTouchhold:function(e){if(this.touch.type)return;var t=this.touch.x1,n=this.touch.y1;x2="x2"in this.touch?this.touch.x2:t,y2="y2"in this.touch?this.touch.y2:n,this.touch.time&&Date.now()-this.touch.time>=this.HOLD_DELAY&&Math.abs(t-x2)<=this.HOLD_TOLERANCE&&Math.abs(n-y2)<=this.HOLD_TOLERANCE&&(this.touch.type="taphold",this._triggerEvent(e))},_direction:function(e,t,n,r){var i=Math.abs(e-t),s=Math.abs(n-r);return i>=s?e-t>0?"left":"right":n-r>0?"up":"down"},preventScroll:function(){return!1},HOLD_DELAY:750,DOUBLE_DELAY:250,HOLD_TOLERANCE:10,SWIPE_TOLERANCE:60,TAP_TOLERANCE:10,RESPONSIVE_TAP:!0,GESTURE_TOLERANCE:20}),Wheel.EventManager.subclass("Wheel.TouchManager",{listen:function(){this._super();var e=this;this.touch={},this.$.on(this.startEvent,function(t){e.onStart(t)}).on(this.moveEvent,function(t){e.onMove(t)}).on(this.endEvent,function(t){e.onEnd(t)})},onStart:function(e){e=this._unpackEvent(e),this._super(e)},onMove:function(e){this._handlePullMove(e);if(this.touch.type)return;e=this._unpackEvent(e),this.multi&&this._detectGesture(e),this._testSwipe(e)},onEnd:function(e){this._super(e),this.multi=undefined},_multiDistance:function(e){return Math.sqrt(Math.pow(this.touch["x"+e]-this.multi["x"+e],2)+Math.pow(this.touch["y"+e]-this.multi["y"+e],2))},_detectGesture:function(e){var t=this._multiDistance(1),n=this._multiDistance(2),r=Math.abs(t-n),i=Math.abs(this.touch.x1-this.touch.x2-(this.multi.x1-this.multi.x2)),s=Math.abs(this.touch.y1-this.touch.y2-(this.multi.y1-this.multi.y2));r>=this.GESTURE_TOLERANCE&&r>=i&&r>=s&&(this.touch.type=t>n?"pinch":"zoom",this._triggerEvent(e))},_normalizeEvent:function(e){return e.normalized?e:(e=e.originalEvent||e,e.touches&&e.touches[0]?(e.pageX=e.touches[0].pageX,e.pageY=e.touches[0].pageY):e.changedTouches&&e.changedTouches[0]&&(e.pageX=e.changedTouches[0].pageX,e.pageY=e.changedTouches[0].pageY,this.touch.x2=e.changedTouches[0].pageX,this.touch.y2=e.changedTouches[0].pageY),e.normalized=!0,e)},_unpackEvent:function(e){return e=this._super(e),e.touches&&e.touches.length>1&&(this.multi?(this.multi.x2=e.touches[1].pageX,this.multi.y2=e.touches[1].pageY):this.multi={x1:e.touches[1].pageX,y1:e.touches[1].pageY}),e},_handleTap:function(e){if(this.multi)return;this._super(e)},startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend"},{id:"Wheel.TouchManager"}),Wheel.EventManager.subclass("Wheel.MouseManager",{listen:function(){function t(t){e.onMove(t)}function n(n){e.onEnd(n),e.$.off(e.moveEvent,t)}this._super();var e=this;this.touch={};this.$.on(this.startEvent,function(n){e.onStart(n),e.$.on(e.moveEvent,t)}),this.$.on(this.endEvent,n)},startEvent:"mousedown",moveEvent:"mousemove",endEvent:"mouseup"})
/*
 * Currently, all js files are expected to be available via the application's root url.
 * Also, the file where your app is packaged is expected to be /app.js at your domain.
 *
 * Override these locations according to your file setup.
 */
Modernizr.load({
  test: Wheel.Utils.Loader.canZepto(),
  yep:  'wheel_modern.js',
  nope: 'wheel_legacy.js',
  both: 'app.js',
  complete: function() {
    Wheel.App.start(); // yup, this will build any subclasses of Wheel.App
  }
});
