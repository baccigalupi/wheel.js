/* Wheel.js - v0.3.0 - 2012-08-24
 * http://github.com/baccigalupi/wheel.js
 * Copyright (c) 2011-2012 Kane Baccigalupi; Licensed MIT: http://github.com/baccigalupi/wheel.js/LICENSE.txt */
window.Modernizr=function(a,b,c){function x(a){j.cssText=a}function y(a,b){return x(m.join(a+";")+(b||""))}function z(a,b){return typeof a===b}function A(a,b){return!!~(""+a).indexOf(b)}function B(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:z(f,"function")?f.bind(d||b):f}return!1}var d="2.5.3",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k,l={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),n={},o={},p={},q=[],r=q.slice,s,t=function(a,c,d,e){var f,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),k.appendChild(j);return f=["&#173;","<style>",a,"</style>"].join(""),k.id=h,(l?k:m).innerHTML+=f,m.appendChild(k),l||(m.style.background="",g.appendChild(m)),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},u=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=z(e[d],"function"),z(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),v={}.hasOwnProperty,w;!z(v,"undefined")&&!z(v.call,"undefined")?w=function(a,b){return v.call(a,b)}:w=function(a,b){return b in a&&z(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(typeof b!="function")throw new TypeError;var c=r.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(r.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(r.call(arguments)))};return d});var C=function(c,d){var f=c.join(""),g=d.length;t(f,function(c,d){var f=b.styleSheets[b.styleSheets.length-1],h=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"",i=c.childNodes,j={};while(g--)j[i[g].id]=i[g];e.touch="ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch||(j.touch&&j.touch.offsetTop)===9},g,d)}([,["@media (",m.join("touch-enabled),("),h,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);n.touch=function(){return e.touch},n.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a};for(var D in n)w(n,D)&&(s=D.toLowerCase(),e[s]=n[D](),q.push((e[s]?"":"no-")+s));return x(""),i=k=null,e._version=d,e._prefixes=m,e.hasEvent=u,e.testStyles=t,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+q.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return o.call(a)=="[object Function]"}function e(a){return typeof a=="string"}function f(){}function g(a){return!a||a=="loaded"||a=="complete"||a=="uninitialized"}function h(){var a=p.shift();q=1,a?a.t?m(function(){(a.t=="c"?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){a!="img"&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l={},o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};y[c]===1&&(r=1,y[c]=[],l=b.createElement(a)),a=="object"?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),a!="img"&&(r||y[c]===2?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i(b=="c"?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),p.length==1&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&o.call(a.opera)=="[object Opera]",l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return o.call(a)=="[object Array]"},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,i){var j=b(a),l=j.autoCallback;j.url.split(".").pop().split("?").shift(),j.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]||h),j.instead?j.instead(a,e,f,g,i):(y[j.url]?j.noexec=!0:y[j.url]=1,f.load(j.url,j.forceCSS||!j.forceJS&&"css"==j.url.split(".").pop().split("?").shift()?"c":c,j.noexec,j.attrs,j.timeout),(d(e)||d(l))&&f.load(function(){k(),e&&e(j.origUrl,i,g),l&&l(j.origUrl,i,g),y[j.url]=2})))}function i(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var j,l,m=this.yepnope.loader;if(e(a))g(a,0,m,0);else if(w(a))for(j=0;j<a.length;j++)l=a[j],e(l)?g(l,0,m,0):w(l)?B(l):Object(l)===l&&i(l,m);else Object(a)===a&&i(a,m)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,b.readyState==null&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var Mustache=typeof module!="undefined"&&module.exports||{};(function(a){function i(a){return h.test(a)}function n(a){return String(a).replace(/&(?!\w+;)|[<>"']/g,function(a){return m[a]||a})}function o(a,b,c,d){d=d||"<template>";var e=b.split("\n"),f=Math.max(c-3,0),g=Math.min(e.length,c+3),h=e.slice(f,g),i;for(var j=0,k=h.length;j<k;++j)i=j+f+1,h[j]=(i===c?" >> ":"    ")+h[j];return a.template=b,a.line=c,a.file=d,a.message=[d+":"+c,h.join("\n"),"",a.message].join("\n"),a}function p(a,b,c){if(a===".")return b[b.length-1];var d=a.split("."),e=d.length-1,f=d[e],g,h,i=b.length,j,k;while(i){k=b.slice(0),h=b[--i],j=0;while(j<e){h=h[d[j++]];if(h==null)break;k.push(h)}if(h&&typeof h=="object"&&f in h){g=h[f];break}}return typeof g=="function"&&(g=g.call(k[k.length-1])),g==null?c:g}function q(a,b,c,d){var e="",h=p(a,b);if(d){if(h==null||h===!1||f(h)&&h.length===0)e+=c()}else if(f(h))g(h,function(a){b.push(a),e+=c(),b.pop()});else if(typeof h=="object")b.push(h),e+=c(),b.pop();else if(typeof h=="function"){var i=b[b.length-1],j=function(a){return w(a,i)};e+=h.call(i,c(),j)||""}else h&&(e+=c());return e}function r(b,c){c=c||{};var d=c.tags||a.tags,e=d[0],f=d[d.length-1],g=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],h=[],k=!1,l=!1,m=function(){if(k&&!l&&!c.space)while(h.length)g.splice(h.pop(),1);else h=[];k=!1,l=!1},n=[],p,q,r,s=function(a){d=j(a).split(/\s+/),q=d[0],r=d[d.length-1]},t=function(a){g.push('";',p,'\nvar partial = partials["'+j(a)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},u=function(a,d){var e=j(a);if(e==="")throw o(new Error("Section name may not be empty"),b,z,c.file);n.push({name:e,inverted:d}),g.push('";',p,'\nvar name = "'+e+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},v=function(a){u(a,!0)},w=function(a){var d=j(a),e=n.length!=0&&n[n.length-1].name;if(!e||d!=e)throw o(new Error('Section named "'+d+'" was never opened'),b,z,c.file);var f=n.pop();g.push('";',"\n    return buffer;","\n  };","\n})();"),f.inverted?g.push("\nbuffer += renderSection(name,stack,callback,true);"):g.push("\nbuffer += renderSection(name,stack,callback);"),g.push('\nbuffer += "')},x=function(a){g.push('";',p,'\nbuffer += lookup("'+j(a)+'",stack,"");','\nbuffer += "')},y=function(a){g.push('";',p,'\nbuffer += escapeHTML(lookup("'+j(a)+'",stack,""));','\nbuffer += "')},z=1,A,B;for(var C=0,D=b.length;C<D;++C)if(b.slice(C,C+e.length)===e){C+=e.length,A=b.substr(C,1),p="\nline = "+z+";",q=e,r=f,k=!0;switch(A){case"!":C++,B=null;break;case"=":C++,f="="+f,B=s;break;case">":C++,B=t;break;case"#":C++,B=u;break;case"^":C++,B=v;break;case"/":C++,B=w;break;case"{":f="}"+f;case"&":C++,l=!0,B=x;break;default:l=!0,B=y}var E=b.indexOf(f,C);if(E===-1)throw o(new Error('Tag "'+e+'" was not closed properly'),b,z,c.file);var F=b.substring(C,E);B&&B(F);var G=0;while(~(G=F.indexOf("\n",G)))z++,G++;C=E+f.length-1,e=q,f=r}else{A=b.substr(C,1);switch(A){case'"':case"\\":l=!0,g.push("\\"+A);break;case"\r":break;case"\n":h.push(g.length),g.push("\\n"),m(),z++;break;default:i(A)?h.push(g.length):l=!0,g.push(A)}}if(n.length!=0)throw o(new Error('Section "'+n[n.length-1].name+'" was not closed properly'),b,z,c.file);m(),g.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var H=g.join("").replace(/buffer \+= "";\n/g,"");return c.debug&&(typeof console!="undefined"&&console.log?console.log(H):typeof print=="function"&&print(H)),H}function s(a,b){var c="view,partials,stack,lookup,escapeHTML,renderSection,render",d=r(a,b),e=new Function(c,d);return function(c,d){d=d||{};var f=[c];try{return e(c,d,f,p,n,q,w)}catch(g){throw o(g.error,a,g.line,b.file)}}}function u(){t={}}function v(a,b){return b=b||{},b.cache!==!1?(t[a]||(t[a]=s(a,b)),t[a]):s(a,b)}function w(a,b,c){return v(a)(b,c)}a.name="mustache.js",a.version="0.5.0-dev",a.tags=["{{","}}"],a.parse=r,a.compile=v,a.render=w,a.clearCache=u,a.to_html=function(a,b,c,d){var e=w(a,b,c);if(typeof d=="function")d(e);else return e};var b=Object.prototype.toString,c=Array.isArray,d=Array.prototype.forEach,e=String.prototype.trim,f;c?f=c:f=function(a){return b.call(a)==="[object Array]"};var g;d?g=function(a,b,c){return d.call(a,b,c)}:g=function(a,b,c){for(var d=0,e=a.length;d<e;++d)b.call(c,a[d],d,a)};var h=/^\s*$/,j;if(e)j=function(a){return a==null?"":e.call(a)};else{var k,l;i("Â ")?(k=/^\s+/,l=/\s+$/):(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),j=function(a){return a==null?"":String(a).replace(k,"").replace(l,"")}}var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},t={}})(Mustache);var Wheel={Mixins:{},Utils:{},Widgeteria:{}};!window.w&&(window.w=Wheel),Wheel.Utils.ObjectPath={write:function(a,b,c){a=a.split("."),c=c||window;var d=a.length,e;if(d>1)for(e=0;e<d-1;e++)c[a[e]]||(c[a[e]]={}),c=c[a[e]];return c[a[d-1]]=b,b},read:function(a,b){a=a.split("."),b=b||window;var c=a.length,d;for(d=0;d<c;d++){if(!b[a[d]])return null;b=b[a[d]]}return b}},function(a){a._?(Wheel.isFunction=_.isFunction,Wheel.isString=_.isString,Wheel.isNumber=_.isNumber,Wheel.isNull=_.isNull,Wheel.isUndefined=_.isUndefined,Wheel.isElement=_.isElement,Wheel.isArray=_.isArray,Wheel.isObject=_.isObject):(Wheel.isFunction=function(a){return typeof a=="function"||toString.call(a)=="[object Function]"},Wheel.isString=function(a){return toString.call(a)=="[object String]"},Wheel.isNumber=function(a){return toString.call(a)=="[object Number]"},Wheel.isNull=function(a){return a===null},Wheel.isUndefined=function(a){return a===void 0},Wheel.isElement=function(a){return!!a&&a.nodeType==1},Wheel.isArray=function(a){return toString.call(a)=="[object Array]"},Wheel.isObject=function(a){return a===Object(a)&&!Wheel.isFunction(a)&&!Wheel.isArray(a)}),Wheel.is$=function(a){return!!a.addClass}}(window),Wheel.Mixins.Events={on:function(a,b,c){var d,e,f,g,h;if(!b)return this;a=a.split(" "),d=this._callbacks||(this._callbacks={});while(e=a.shift())h=d[e],f=h?h.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:h?h.next:f};return this},off:function(a,b,c){var d,e,f,g,h,i;if(!(e=this._callbacks))return this;if(!(a||b||c))return delete this._callbacks,this;a=a?a.split(" "):_.keys(e);while(d=a.shift()){f=e[d],delete e[d];if(!f||!b&&!c)continue;g=f.tail;while((f=f.next)!==g)h=f.callback,i=f.context,(b&&h!==b||c&&i!==c)&&this.on(d,h,i)}return this},trigger:function(a){var b,c,d,e,f,g,h,i;if(!(d=this._callbacks))return this;i=Array.prototype.slice,g=d.all,a=a.split(" "),h=i.call(arguments,1);while(b=a.shift()){if(c=d[b]){e=c.tail;while((c=c.next)!==e)c.callback.apply(c.context||this,h)}if(c=g){e=c.tail,f=[b].concat(h);while((c=c.next)!==e)c.callback.apply(c.context||this,f)}}return this}},Wheel.Mixins.Ajax={send:function(a){this._requestQueue=this._requestQueue||Wheel.Utils.RequestQueue.singleton;var b=this.data(),c={url:this.url,context:this,data:b,type:a&&a.httpMethod||this.httpMethod,dataType:this.dataType||"json",success:this.onSuccess,error:this.processError,complete:this.onCompletion};a&&$.extend(c,a),this._requestQueue.add(c)},processError:function(a){try{this.onError(JSON.parse(a.responseText))}catch(b){this.onError({status:a.statusCode(),message:a.responseText})}},data:function(){return{}},onCompletion:function(a){},onSuccess:function(a){},onError:function(a){}},function(){Function.prototype.bind=Function.prototype.bind||function(a){var b=this;return function(){return b.apply(a,arguments)}};var a=function(a,b){function c(){}var d=function(){var d,e=this._super;return this._super=b||c,d=a.apply(this,arguments),this._super=e,d};return d.base=a,d},b=function(b,c,d){if(!c)return b;for(prop in c){if(prop.match(/prototype|__proto__|superclass/))continue;var e,f;d?(e=c[prop],f=b[prop]):(e=b[prop],f=c[prop]);if(e&&f&&typeof f=="function")b[prop]=function(b,c){return a(b,c)}(f,e);else if(f||e)b[prop]=f||e}return b};Wheel._Class=function(){},Wheel._Class.mashin=function(a){return b(this,a,!0),this},Wheel._Class.mashover=function(a){return b(this,a),this},Wheel._Class.mixin=function(a){return b(this.prototype,a,!0),this},Wheel._Class.mixover=function(a){return b(this.prototype,a),this};var c=!1;Wheel._Class.subclass=function(){function g(){c||this.initialize&&this.initialize.apply(this,arguments)}var a,d,e,f;typeof arguments[0]=="string"?(a=arguments[0],e=arguments[1],f=arguments[2]):(e=arguments[0],f=arguments[1]),c=!0,d=new this,c=!1;for(h in this){var h;if(h=="prototype")continue;g[h]=this[h]}return b(g,f),g.superclass=this,g._subclass=Wheel._Class.subclass,g.prototype=b(d,e),g.prototype.constructor=g,g.prototype.superclass=this.prototype,g.prototype._class=g.prototype.constructor,a&&(g.id=a,Wheel.Utils.ObjectPath.write(a,g)),g}}(),Wheel._Class.subclass("Wheel.Base",{initialize:function(a){this._preInit(a),this.init(),this._postInit()},_preInit:function(a){this._uid=this._class.uid(),this.optionize(a)},_postInit:function(){this.listen()},optionize:function(a){var b={},c;for(c in a)typeof this._class.prototype[c]=="function"?this["_"+c]=a[c]:this[c]=a[c]},init:function(){},listen:function(){},publish:function(a,b){this._throwIfNoPublisher(),Wheel.Publisher.trigger(a,b)},subscribe:function(a,b,c){this._throwIfNoPublisher(),Wheel.Publisher.on(a,b,c||this)},_throwIfNoPublisher:function(){if(!Wheel.Publisher)throw"Wheel.Publisher is not defined. We cannot use publish/subscribe yet!"}},{uid:function(){return Wheel.Base._uid=Wheel.Base._uid||0,++Wheel.Base._uid},build:function(){function b(b){return a.apply(this,b)}var a=this;return b.prototype=a.prototype,new b(arguments)},attrAccessor:function(a){var b="_"+a;this.prototype[a]=function(c){return c!==undefined&&(this[b]=c,self[b]!=c&&(this.trigger("change"),this.trigger("change:"+a))),this[b]}},subclass:function(a,b,c){var d=this._subclass(a,b,c);d.properties&&d.properties.length&&$.each(d.properties,function(a,b){typeof d.prototype[b]!="function"&&d.attrAccessor(b)});if(Wheel.isString(a)){var e=a.split("."),f=e.length,g,h=window;for(g=0;g<f-1;g++){var h=window[e[g]];if(h&&h._typeof==="Wheel.App"){d.App=h;break}}}return d}}),Wheel.Base.mixin(Wheel.Mixins.Events),Wheel.Class=function(a,b,c){return Wheel.Base.subclass(a,b,c)},Wheel.Base.subclass("Wheel.Class.Singleton",{initialize:function(a){this._class.singleton||(this._class.singleton=this,this._super(a))}},{build:function(){return this.singleton?this.singleton:this._super.apply(this,arguments)}}),Wheel.Utils.Loader={canZepto:function(a){a=a||navigator.userAgent;var b=!1;return/AppleWebKit/i.test(a)?/Silk\/(\d+)/i.test(a)?b=parseInt(a.match(/Silk\/(\d+)/i)[1])>=1:/mobile|android/i.test(a)?b=parseInt(a.match(/version\/(\d+)/i)[1])>=4:/webos\/(\d+)\.(\d+)\.(\d+)/i.test(a)?b=this._versionTest(a.match(/webos\/(\d+)\.(\d+)\.(\d+)/i),[1,4,5]):/RIM Tablet OS (\d+)\.(\d+)\.(\d+)/i.test(a)?b=this._versionTest(a.match(/RIM Tablet OS (\d+)\.(\d+)\.(\d+)/i),[1,0,7]):b=a.match(/Chrome\/(\d+)/)&&parseInt(a.match(/Chrome\/(\d+)/)[1])>=5||/Version\/5.*Safari/.test(a):b=a.match(/Firefox\/(\d+)/)&&parseInt(a.match(/Firefox\/(\d+)/)[1])>=4||a.match(/(Opera).*Version\/(\d+)/i)&&parseInt(a.match(/Version\/(\d+)/i)[1])>=10,!!b},_versionTest:function(a,b){return a[1]=parseInt(a[1]),a[2]=parseInt(a[2]),a[3]=parseInt(a[3]),a[1]>=b[0]&&(a[2]>b[1]||a[2]==b[1]&&a[3]>=b[2])}},Wheel.Class.Singleton.subclass("Wheel.Utils.ConnectionChecker",{init:function(){this.url="/",this.intervalDelay=this._class.intervalDelay,this.pollCount=0,this._super()},opts:{async:!1,url:this.url,context:this,type:"head",dataType:"json"},test:function(){$.ajax($.extend(this.opts,{success:this.onSuccess,error:this.onError}))},clearInterval:function(){this.interval&&(clearInterval(this.interval),this.interval=undefined)},setInterval:function(){this.interval=setInterval(function(){$.ajax($.extend(this.opts,{success:self.stopPoll,error:self.continuePoll}))},this.intervalDelay)},startPoll:function(){var a=this;this.pollCount=1,this.setInterval()},isPolling:function(){return!!this.interval},stopPoll:function(){this.clearInterval(),this.intervalDelay=this._class.intervalDelay,this.pollCount=0,this.onSuccess()},continuePoll:function(){this.pollCount++,this.pollCount>10&&this.intervalDelay<this._class.intervalDelayLimit&&(this.clearInterval(),this.intervalDelay*=2,this.setInterval(),this.pollCount=0)},onSuccess:function(a){this.trigger("online")},onError:function(a){this.trigger("offline"),!this.isPolling()&&this.startPoll()}},{intervalDelay:1e4,intervalDelayLimit:12e4,id:"Wheel.Utils.ConnectionChecker"}),Wheel.Utils.ConnectionChecker.mixin(Wheel.Mixins.Events),Wheel.Class.Singleton.subclass("Wheel.Utils.RequestQueue",{init:function(){this._requestCount=0,this._requests=[],this._contexts={},this._state="online",this.app.on("offline",this.offline,this)},add:function(a){this._requests.push(a),this.start()},_inContext:function(a){return!!(a&&a._uid&&this._contexts[a._uid])},start:function(a){a=a||0;var b=this._requests[a];if(b&&this._state=="online"&&this.app.connected()&&this._requestCount<this._class.connectionLimit()){var c=b.context&&b.context._uid;!b._inProgress&&!this._inContext(b.context)&&(this.send(b),this._requests[a]._inProgress=!0,c&&(this._contexts[c]=!0),this._requestCount++),this.start(a+1)}},offline:function(){this._state="offline",this.app.on("online",this.restart,this)},restart:function(){this.app.off("online",this.restart),this._state="restarting";var a=this;setTimeout(function(){a._reset()},5e3)},_reset:function(){this._state=="restarting"&&(this.start(),this._requestCount=0,this._contexts={},$.each(this._requests,function(a,b){b._inProgress&&(b._inProgress=!1)}))},send:function(a){var b=this,c=$.extend({},a);c.success=function(c){b.onSuccess(c,a)},c.complete=function(c){b.onComplete(c,a)},c.error=function(c){b.onError(c,a)},typeof c.url=="function"&&(c.url=c.url());var d=(c.httpMethod||c.type||"get").toLowerCase();if(d=="put"||d=="delete")c.type="post",c.data=c.data||{},c.data._method=d;c.context=null,$.ajax(c)},onSuccess:function(a,b){this._clearRequest(b),this._callback(a,b,"success")},onError:function(a,b){this.app.checkConnection(),this.app.connected()&&(this._clearRequest(b),this._callback(a,b,"error"))},onComplete:function(a,b){this._requestCount--,this.app.connected()&&(this._callback(a,b,"complete"),this.start())},_clearRequest:function(a){a.context&&a.context._uid&&delete this._contexts[a.context._uid],this._requests.splice(this._requests.indexOf[a],1)},_callback:function(a,b,c){b[c]&&(b.context?b[c].apply(b.context,[a]):b[c](a))}},{connectionLimit:function(){return this._connectionLimit||(this._connectionLimit=Wheel.Utils.Loader.canZepto()?6:2),this._connectionLimit},id:"Wheel.Utils.RequestQueue"}),Wheel.Class("Wheel.App",{_preInit:function(a){this._super(a),this.initApp(),this._class.app=this,window.app=this},initApp:function(){this.eventManager=Modernizr.touch?Wheel.TouchManager.build():Wheel.MouseManager.build(),this.templates=Wheel.Templates.build(),this.templates.gather()},manageRequests:function(){this.connectionChecker=Wheel.Utils.ConnectionChecker.build(),this.requestQueue=Wheel.Utils.RequestQueue.build({app:this}),this.connectionChecker.on("offline",function(){this.connected(!1)}.bind(this)),this.connectionChecker.on("online",function(){this.connected(!0)}.bind(this))},checkConnection:function(){"onLine"in navigator&&navigator.onLine==!1?this.connected(!1):this.connectionChecker.test()},connected:function(a){if(a!=undefined&&this._connected!=a){var b=a?"online":"offline";this._connected=a,this.trigger(b)}return a===!1&&this.trigger("offline-beacon"),this._connected}},{Views:{},Models:{},_typeof:"Wheel.App",subclass:function(a,b,c){this.children=this.children||[];var d=this._super(a,b,c);return this.children.push(d),d},start:function(){this.children&&$.each(this.children,function(a,b){b.build()})}}),Wheel.Class.Singleton.subclass("Wheel.Templates",{optionize:function(a){this.append(a)},gather:function(){var a=this;$("script.template").each(function(b,c){var d=$(c);Wheel.Utils.ObjectPath.write(d.attr("name"),d.html(),a)})},retrieve:function(a){var b=this;$.ajax({url:a||"/templates",success:function(a){b.append(a)}})},append:function(a){var b;for(b in a)Wheel.Utils.ObjectPath.write(b,a[b],this)}}),Wheel.Class("Wheel.View",{initialize:function(a,b){this.initializeDom(a,b),this.init(),this._postInit()},initializeDom:function(a,b){a&&(a.addClass||a instanceof HTMLElement||Wheel.isString(a))?(this._preInit(b),this.$=this.wrapDom(a)):(this._preInit(a),this.$=this.renderDefault())},wrapDom:function(a){return $(a)},renderDefault:function(){var a=this.renderTemplate();return this.parent&&this.appendToParent(a),a},renderTemplate:function(a,b){var c;return Wheel.isString(a)?c=a:b=a,$(Mustache.render(this._class.template(c),b||this.viewModel()))},appendToParent:function(a){this.parent.append?this.parent.append(a):$(this.parent).append(a)},viewModel:function(){var a;return this.model?a=this.model:a=this,a},_delegate:function(a,b){if($.isArray(b)){var c=this;$.each(b,function(b,d){c._delegateOne(a,d)})}else this._delegateOne(a,b)},_delegateOne:function(a,b){this.$[a](b.$||b)},append:function(a){this._delegate("append",a)},prepend:function(a){this._delegate("prepend",a)},find:function(a){this._delegateOne(a)}},{templateRepository:function(){return this._templateRepository||(this._templateRepository=this._getTemplateRepository()),this._templateRepository},_getTemplateRepository:function(){return window.app&&window.app.templates},templates:function(){if(!this._templates){this._templates=Wheel.Utils.ObjectPath.read(this.id,this.templateRepository());var a=this.superclass.templates&&this.superclass.templates();if(a&&this._templates){var b;for(b in a)this._templates[b]||(this._templates[b]=a[b])}}return this._templates},defaultTemplate:"default",template:function(a){var b=this.templates();if(!b)throw"No templates found for View: "+this.id;var c;return Wheel.isString(b)?c=b:c=a?b[a]:b[this.defaultTemplate],c},gather:function(a,b){if(!this.selector)throw"Define a selector on the class to use the 'gather' class method";var c=[],d=this;return Wheel.isObject(a)&&!Wheel.isElement(a)?(b=a,a=$(document.body)):(b=b||{},a=Wheel.is$(a)?a:$(a)),a.is(this.selector)?c.push(new d(a,b)):$.each(a.find(this.selector),function(a,e){c.push(new d(e,b))}),c},assemble:function(a,b){var c=[];return b=b||{},$.each(a,function(a,d){b.model=d,c.push(this.build(b))}.bind(this)),c}}),Wheel.View.subclass("Wheel.EventManager",{initializeDom:function(a){this.optionize(a),this.$=$(document)},listen:function(){var a=this;this.$.on("draginit",function(b){a.onDragInit(b)})},onDragInit:function(a){a.preventDefault(),this._setTarget(a),this.touch.type="drag",a=this._unpackEvent(a),this._triggerEvent(a,"dragstart")},onStart:function(a){this.touch.ctrl=a.ctrlKey,a=this._normalizeEvent(a),this._setTarget(a),this._triggerEvent(a,"tapstart"),this._clearTimeout(),this.touch.x1=a.pageX,this.touch.y1=a.pageY,this.touch.time=Date.now();if(!this._testDoubleTap()&&!this.touch.ctrl){var b=this;this.touchTimout=setTimeout(function(){b._testTouchhold(a)},this.HOLD_DELAY)}},onMove:function(a){this._handleDragMove(a);if(this.touch.type)return;a=this._unpackEvent(a),this._testSwipe(a)},onEnd:function(a){a=this._unpackEvent(a),this._triggerEvent(a,"tapend"),this._handleDragEnd(a),this.touch.type||this.touch.ctrl?this._resetTouch():this._handleTap(a)},_triggerEvent:function(a,b){if(!this.target)return;var c="x2"in this.touch?this.touch.x2:this.touch.x1,d="y2"in this.touch?this.touch.y2:this.touch.y1;this.target.trigger($.Event(b||this.touch.type,{originalEvent:a,pageX:c,pageY:d}))},_setTarget:function(a){var b=a.target;this.target=$("tagName"in b?b:b.parentNode)},_clearTimeout:function(){this.touchTimeout&&clearTimeout(this.touchTimeout)},_resetTouch:function(){this.lastTouch=this.touch,this.lastTouch.target=this.target,this.target=null,this.touch={}},_normalizeEvent:function(a){return a},_unpackEvent:function(a){return a=this._normalizeEvent(a),a.type!=="touchend"&&(this.touch.x2=a.pageX>=0?a.pageX:this.touch.x1,this.touch.y2=a.pageY>=0?a.pageY:this.touch.y1),a},_handleTap:function(a){if(this.RESPONSIVE_TAP)this._onTap(a);else{var b=this;this.touchTimeout=setTimeout(function(){b._onTap(a)},this.DOUBLE_DELAY)}},_handleDragMove:function(a){this.touch.type&&this.touch.type==="drag"&&(a.preventDefault(),a=this._unpackEvent(a),this._triggerEvent(a,"dragmove"))},_handleDragEnd:function(a){this.touch.type&&this.touch.type==="drag"&&(a=this._unpackEvent(a),this._triggerEvent(a,"dragend"))},_onTap:function(a){this.touchTimeout=null,this.target&&a.target===this.target[0]&&this.TAP_TOLERANCE>=Math.abs(this.touch.x1-this.touch.x2)&&this.TAP_TOLERANCE>=Math.abs(this.touch.y1-this.touch.y2)&&(this.touch.type="tap",this._triggerEvent(a)),this._resetTouch()},_testDoubleTap:function(a){var b=this.lastTouch&&this.lastTouch.time?this.touch.time-this.lastTouch.time:0;if(b>0&&b<=this.DOUBLE_DELAY)return this.touch.type="doubletap",this._triggerEvent(a),!0},_testSwipe:function(a){if(Math.abs(this.touch.x1-this.touch.x2)>=this.SWIPE_TOLERANCE||Math.abs(this.touch.y1-this.touch.y2)>=this.SWIPE_TOLERANCE){this.touch.type="swipe";var b=this._direction(this.touch.x1,this.touch.x2,this.touch.y1,this.touch.y2);this.preventScroll(b)&&a.preventDefault(),this._triggerEvent(a),this._triggerEvent(a,"swipe"+b)}},_testTouchhold:function(a){if(this.touch.type)return;var b=this.touch.x1,c=this.touch.y1;x2="x2"in this.touch?this.touch.x2:b,y2="y2"in this.touch?this.touch.y2:c,this.touch.time&&Date.now()-this.touch.time>=this.HOLD_DELAY&&Math.abs(b-x2)<=this.HOLD_TOLERANCE&&Math.abs(c-y2)<=this.HOLD_TOLERANCE&&(this.touch.type="taphold",this._triggerEvent(a))},_direction:function(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"left":"right":c-d>0?"up":"down"},preventScroll:function(){return!1},HOLD_DELAY:750,DOUBLE_DELAY:250,HOLD_TOLERANCE:10,SWIPE_TOLERANCE:60,TAP_TOLERANCE:10,RESPONSIVE_TAP:!0,GESTURE_TOLERANCE:20}),Wheel.EventManager.subclass("Wheel.MouseManager",{listen:function(){function b(b){a.onMove(b)}function c(c){a.onEnd(c),a.$.off(a.moveEvent,b)}this._super();var a=this;this.touch={},this.$.on(this.startEvent,function(c){a.onStart(c),a.$.on(a.moveEvent,b)}),this.$.on(this.endEvent,c)},startEvent:"mousedown",moveEvent:"mousemove",endEvent:"mouseup"}),Wheel.EventManager.subclass("Wheel.TouchManager",{listen:function(){this._super();var a=this;this.touch={},this.$.on(this.startEvent,function(b){a.onStart(b)}).on(this.moveEvent,function(b){a.onMove(b)}).on(this.endEvent,function(b){a.onEnd(b)})},onStart:function(a){a=this._unpackEvent(a),this._super(a)},onMove:function(a){this._handleDragMove(a);if(this.touch.type)return;a=this._unpackEvent(a),this.multi&&this._detectGesture(a),this._testSwipe(a)},onEnd:function(a){this._super(a),this.multi=undefined},_multiDistance:function(a){return Math.sqrt(Math.pow(this.touch["x"+a]-this.multi["x"+a],2)+Math.pow(this.touch["y"+a]-this.multi["y"+a],2))},_detectGesture:function(a){var b=this._multiDistance(1),c=this._multiDistance(2),d=Math.abs(b-c),e=Math.abs(this.touch.x1-this.touch.x2-(this.multi.x1-this.multi.x2)),f=Math.abs(this.touch.y1-this.touch.y2-(this.multi.y1-this.multi.y2));d>=this.GESTURE_TOLERANCE&&d>=e&&d>=f&&(this.touch.type=b>c?"pinch":"zoom",this._triggerEvent(a))},_normalizeEvent:function(a){return a.normalized?a:(a=a.originalEvent||a,a.touches&&a.touches[0]?(a.pageX=a.touches[0].pageX,a.pageY=a.touches[0].pageY):a.changedTouches&&a.changedTouches[0]&&(a.pageX=a.changedTouches[0].pageX,a.pageY=a.changedTouches[0].pageY,this.touch.x2=a.changedTouches[0].pageX,this.touch.y2=a.changedTouches[0].pageY),a.normalized=!0,a)},_unpackEvent:function(a){return a=this._super(a),a.touches&&a.touches.length>1&&(this.multi?(this.multi.x2=a.touches[1].pageX,this.multi.y2=a.touches[1].pageY):this.multi={x1:a.touches[1].pageX,y1:a.touches[1].pageY}),a},_handleTap:function(a){if(this.multi)return;this._super(a)},startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend"},{id:"Wheel.TouchManager"});